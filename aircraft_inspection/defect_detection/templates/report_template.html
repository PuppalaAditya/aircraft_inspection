<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Aircraft Defect Detection Report</title>
  <style>
    /* ===== Page / Typography ===== */
    @page {
      size: A4;
      margin: 18mm 16mm 18mm 16mm;
    }
    html, body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: #0f172a; /* slate-900 */
      line-height: 1.45;
      font-size: 12px;
    }
    h1, h2, h3 {
      margin: 0 0 8px 0;
      line-height: 1.25;
      color: #0b1b40;
    }
    h1 { font-size: 22px; letter-spacing: .3px; }
    h2 { font-size: 15px; margin-top: 14px; }
    h3 { font-size: 13px; margin-top: 10px; }
    p { margin: 3px 0; }
    .muted { color:#475569; } /* slate-600 */

    /* ===== Layout Helpers ===== */
    .row { display: table; width: 100%; table-layout: fixed; }
    .col { display: table-cell; vertical-align: top; }
    .w-60 { width: 60%; } .w-40 { width: 40%; }
    .mt-2{ margin-top: 8px;} .mt-3{ margin-top: 12px;} .mt-4{ margin-top: 16px;}
    .mb-2{ margin-bottom: 8px;} .mb-3{ margin-bottom: 12px;} .mb-4{ margin-bottom: 16px;}
    .center { text-align: center; }
    .right { text-align: right; }

    /* ===== Cards & Lines ===== */
    .card {
      border: 1px solid #e2e8f0; /* slate-200 */
      border-radius: 8px;
      padding: 10px 12px;
      background: #ffffff;
    }
    .hr {
      height: 1px; background: #e2e8f0; border: 0; margin: 10px 0 12px 0;
    }

    /* ===== Data Tables ===== */
    table.meta, table.listing {
      width: 100%;
      border-collapse: collapse;
    }
    table.meta th, table.meta td {
      padding: 6px 8px;
      border-bottom: 1px solid #e2e8f0;
      text-align: left;
      vertical-align: top;
      font-size: 11.5px;
    }
    table.meta th { width: 34%; color: #334155; font-weight: 700; background: #f8fafc; }
    table.listing th {
      background: #f1f5f9; color:#1f2937; font-weight:700; font-size:11.5px;
      border-bottom: 1px solid #e2e8f0;
      padding: 7px 8px;
    }
    table.listing td { padding: 7px 8px; border-bottom: 1px solid #e2e8f0; }
    .nowrap{ white-space: nowrap; }

    /* ===== Badges / Pills ===== */
    .pill {
      display: inline-block;
      padding: 3px 8px;
      font-weight: 700;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      color: #0b1b40;
    }
    .pill-ok { background:#ecfdf5; color:#065f46; border-color:#a7f3d0; }
    .pill-risk { background:#fef2f2; color:#991b1b; border-color:#fecaca; }

    /* ===== Image ===== */
    .snapshot {
      max-width: 100%;
      max-height: 420px;
      width: auto;
      display: block;
      margin: 6px auto 0 auto;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      background: #f8fafc;
    }

    /* ===== Lists ===== */
    ul.clean { margin: 6px 0 2px 16px; padding: 0; }
    ul.clean li { margin: 2px 0; }

    /* ===== Footer / Watermark (optional) ===== */
    .footer {
      margin-top: 10mm;
      font-size: 10px;
      color:#64748b;
      border-top: 1px solid #e2e8f0;
      padding-top: 6px;
      text-align: center;
    }
    .watermark {
      position: fixed;
      top: 45%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 56px; color:#0b1b40;
      opacity: .04; letter-spacing: 2px; white-space: nowrap;
      pointer-events: none;
    }

    /* Avoid split of the snapshot block across pages */
    .avoid-break { page-break-inside: avoid; }

  </style>
</head>
<body>

  <!-- Optional light watermark -->
  <div class="watermark">AIRCRAFT INSPECTION</div>

  <!-- Header -->
  <div class="row">
    <div class="col w-60">
      <h1>Aircraft Defect Detection Report</h1>
      <p class="muted">Generated on: <strong>{{ date }}</strong></p>
    </div>
    <div class="col w-40 right">
      {% if qr_base64 %}
        <img src="data:image/png;base64,{{ qr_base64 }}" alt="QR" width="86" height="86" />
        <div class="muted" style="font-size:10px;">Verification QR</div>
      {% endif %}
    </div>
  </div>

  <hr class="hr" />

  <!-- Metadata -->
  <div class="card mb-3">
    <table class="meta">
      <tr>
        <th>Inspector</th>
        <td>{{ inspector|default:"—" }}</td>
      </tr>
      <tr>
        <th>Aircraft / Section</th>
        <td>{{ aircraft_id|default:"—" }}{% if section %} — {{ section }}{% endif %}</td>
      </tr>
      <tr>
        <th>Model / Version</th>
        <td>{{ model_version|default:"YOLO" }}</td>
      </tr>
      <tr>
        <th>Run ID</th>
        <td>{{ run_id|default:"—" }}</td>
      </tr>
    </table>
  </div>

  <!-- Snapshot -->
  <div class="card avoid-break">
    <h2>Inspection Snapshot</h2>
    <p class="muted">Detected defects are highlighted with bounding boxes.</p>
    <img class="snapshot" src="{{ image_path }}" alt="Detected snapshot"/>
  </div>

  <!-- Findings -->
  <div class="row mt-3">
    <div class="col w-60 pr-2">
      <div class="card">
        <h2>Detected Defects</h2>
        {% if labels %}
          <ul class="clean">
            {% for label in labels %}
              <li>{{ label }}</li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="muted">No individual detections listed.</p>
        {% endif %}
      </div>
    </div>
    <div class="col w-40 pl-2">
      <div class="card">
        <h2>Summary</h2>
        {% if defect_counts %}
          <table class="listing">
            <thead>
              <tr><th class="nowrap">Type</th><th class="right nowrap">Count</th></tr>
            </thead>
            <tbody>
              {% for key, count in defect_counts.items %}
              <tr>
                <td class="nowrap">{{ key }}</td>
                <td class="right nowrap"><strong>{{ count }}</strong></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="muted">No summary available.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Risk -->
  <div class="card mt-3">
    <h2>Risk Assessment</h2>
    {% if is_dangerous %}
      <p class="pill pill-risk">Critical — Immediate Maintenance</p>
      <p class="mt-2">Severe defects detected (e.g., cracks or missing fastener heads). Recommend grounding and urgent inspection by MRO.</p>
    {% else %}
      <p class="pill pill-ok">No Critical Risks</p>
      <p class="mt-2">No critical risk signatures were identified in this scan. Continue routine maintenance per schedule.</p>
    {% endif %}
  </div>

  <!-- Footer -->
  <div class="footer">
    Generated by the Aircraft Inspection System · This document is for maintenance use only.
  </div>
</body>
</html>
